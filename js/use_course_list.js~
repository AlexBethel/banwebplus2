$(
	function() {
		init_course_list();
		draw_tab("Classes");
		draw_subject_selector(-1);
		update_tab_contents();
	}
);

function get_tab_by_tabname(s_tabname) {
	var a_tabs = $(".tab");
	var jtab = null;
	for(var i = 0; i < a_tabs.length; i++){
		if ($(a_tabs[i]).text() == s_tabname) {
			jtab = $(a_tabs[i]);
		}
	}
	return jtab;
}

function update_tab_contents() {
	var s_tabname = $($(".tab.selected")[0]).text();
	var jtab = get_tab_by_tabname(s_tabname);
	$(jtab.children("input")[0]).val($("div.tab_contents").html());
	setTimeout(
		"update_tab_contents();",
		500
	);
}

function draw_subject_selector(index) {
	var jselect = $("#subject_selector");
	kill_children($("#subject_selector"));
	var options = '<option value="-1">&nbsp;</option>';
	for(var i = 0; i < subjects.length; i++) {
		var selected = '';
		if (i == index)
			selected = " selected";
		options += '<option value="'+i+'"'+selected+'>'+subjects[i][1]+'</option>';
	}
	jselect.append(options);
}

function draw_tab(s_tabname) {
	// get the tab and it's contents
	var jtab_contents = $("div.tab_contents");
	var jtab = get_tab_by_tabname(s_tabname);
	var tab_contents = $(jtab.children("input")[0]).val();
	var spacer = "<div class='spacer_for_div_contents'>&nbsp;</div>";
	if (tab_contents.indexOf('spacer_for_div_contents') == -1)
		tab_contents = spacer+tab_contents;
	kill_children(jtab_contents);
	jtab_contents.html("");
	jtab_contents.append(tab_contents);
	jtab_contents.stop(false,true);
	jtab_contents.css({opacity:0});
	jtab_contents.animate({opacity:1},500);
	// set the tab class
	var a_tabs = $(".tab");
	for(var i = 0; i < a_tabs.length; i++)
		$(a_tabs[i]).removeClass("selected");
	jtab.addClass("selected");
}

function kill_children(jobject) {
	var children = jobject.children();
	for(var i = 0; i < children.length; i++)
		$(children[i]).remove();
}

function draw_course_table(input_id) {
	// draw the table
	var index = parseInt($("#"+input_id).val());
	if (index < 0)
		return;
	var jclasses_content = $("#classes_content");
	kill_children(jclasses_content);
	jclasses_content.append(create_table(headers,
										 full_course_list[index]));
	jclasses_content.stop(false,true);
	jclasses_content.css({opacity:0});
	jclasses_content.animate({opacity:1},500);
	// draw the selecter
	draw_subject_selector(index);
}

function init_course_list() {
	for(var i = 0; i < full_course_list.length; i++){
		var course_list = full_course_list[i];
		for (var j = 0; j < course_list.length; j++) {
			course_list[j].splice(0,0,"","");
		}
		full_course_list[i] = course_list;
	}
}